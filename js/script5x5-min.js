const arr=[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,""],arrResult=[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,""],field=document.querySelectorAll(".game-board"),dice=document.querySelectorAll(".dice"),count=document.querySelector(".counter"),timer=document.querySelector(".timer"),start_game=document.querySelector(".start-game"),game_board_wrapper=document.querySelector(".game-board-wrapper"),screen_container=document.querySelector(".screen__container"),wrapper_hidden=document.querySelector(".wrapper__hidden"),go_back=document.querySelector(".go_back"),congratulations_step=document.querySelector(".congratulations__step"),congratulations_time=document.querySelector(".congratulations__time"),pause=document.querySelector(".pause"),settings=document.querySelector(".settings"),settings_row=document.querySelector(".settings__row"),settings_icon=document.querySelector(".settings__icon"),item_volume=document.querySelector(".item__volume-settings"),volume_up=document.querySelector(".fa-volume-up"),date_results=document.querySelector(".date__results"),time_results=document.querySelector(".time__results"),moves_results=document.querySelector(".moves__results"),results_name=document.querySelector(".results__name"),results_date=document.querySelector(".results__date"),results_time=document.querySelector(".results__time"),results_moves=document.querySelector(".results__moves"),results_size=document.querySelector(".results__size");let switchState=!0,score=0,sec=0,min=0,bigMin=0,taimer=null,itemsArray=localStorage.getItem("items")?JSON.parse(localStorage.getItem("items")):[];function startGame(){start_game.addEventListener("click",()=>{pause.classList.contains("active")||(start_game.classList.toggle("active"),start_game.classList.contains("active")?(start_game.textContent="finish",shuffle(arr),makeGameField(arr),Sound(),Timer()):(start_game.textContent="start",clearInterval(taimer),score=0,sec=0,min=0,bigMin=0,count.textContent=score,timer.textContent=`${bigMin}${min}:0${sec}`))})}function shuffle(e){return e.sort(()=>Math.random()-.5),e}function Timer(){taimer=setInterval(()=>{pause.classList.contains("active")||(sec++,sec<10&&(timer.textContent=`${bigMin}${min}:0${sec}`),sec>=10&&(timer.textContent=`${bigMin}${min}:${sec}`),sec>=59&&(min++,sec=-1),min>9&&(bigMin++,min=0))},1e3)}function timeInSec(e,t,s){let a=null;return 0===e&&0===t?s:1===t&&0===e||t>1&&0===e?(a=60*t+s,a):e>0?(a=60*e*10+60*t+s,a):void 0}function makeGameField(e){for(let t=0;t<e.length;t++)dice[t].innerHTML=e[t],""===dice[t].innerHTML&&dice[t].classList.add("empty"),""!==dice[t].innerHTML&&dice[t].classList.remove("empty")}function pauseGame(){pause.addEventListener("click",e=>{e.preventDefault(),pause.classList.toggle("active"),pause.classList.contains("active")?pause.textContent="Resume game":pause.textContent="Pause game"})}function moveDice(e){let t=e.target.closest(".dice");if(!t||""==t.textContent)return;let s=arr.indexOf(+t.textContent);!pause.classList.contains("active")&&start_game.classList.contains("active")&&setTimeout(()=>{""==arr[s+1]&&(arr[s+1]=arr[s],arr[s]="",makeGameField(arr),count.textContent=++score),""==arr[s-1]&&(arr[s-1]=arr[s],arr[s]="",makeGameField(arr),count.textContent=++score),""==arr[s+5]&&(arr[s+5]=arr[s],arr[s]="",makeGameField(arr),count.textContent=++score),""==arr[s-5]&&(arr[s-5]=arr[s],arr[s]="",makeGameField(arr),count.textContent=++score)},300),setTimeout(()=>{if(arr.join(",")===arrResult.join(",")){switchState&&(switchState=!switchState),congratulations_step.textContent=`You won the game in ${score} moves!`,congratulations_time.textContent=`You've spent ${bigMin}${min}min ${sec}sec and you solved puzzle 5x5!`;let e={name:"User",data:getDateNow(),time:`${bigMin}${min}min ${sec}sec`,moves:score,secTime:timeInSec(bigMin,min,sec),size:localStorage.getItem("SIZE")};itemsArray.push(e),localStorage.setItem("items",JSON.stringify(itemsArray)),setTimeout(()=>{wrapper_hidden.classList.add("active")},200),setTimeout(()=>{screen_container.classList.add("active")},400),go_back.addEventListener("click",()=>{wrapper_hidden.classList.remove("active"),screen_container.classList.remove("active"),window.location.reload()}),clearInterval(taimer),score=0,sec=0,min=0,bigMin=0,count.textContent=score,timer.textContent=`${bigMin}${min}:0${sec}`,start_game.textContent="start",start_game.classList.remove("active")}},310)}function settingsModal(){settings_icon.addEventListener("click",()=>{settings_icon.classList.toggle("active"),settings_icon.classList.contains("active")?setTimeout(()=>{settings.classList.add("active"),settings_row.classList.add("active")},200):(settings.classList.remove("active"),settings_row.classList.remove("active"))})}function switchSound(){const e=document.createElement("i"),t=document.createElement("i");item_volume.addEventListener("click",()=>{item_volume.classList.toggle("active"),switchState=!switchState,item_volume.classList.contains("active")?(volume_up.remove(),t.remove(),e.className="fas fa-volume-mute",item_volume.append(e)):(e.remove(),t.className="fas fa-volume-up",item_volume.append(t))})}function Sound(){field[0].addEventListener("click",()=>{switchState&&(clickSound=new Audio("./sound/click.mp3"),clickSound.play())})}function setName(e){"keypress"===e.type?13!=e.which&&13!=e.keyCode||(localStorage.setItem("name",e.target.textContent),name_user.blur()):localStorage.setItem("name",e.target.textContent)}function getDateNow(){let e=new Date;return`${e.getDate()}.${e.getMonth()+1}.${e.getFullYear()}`}function addDataTolocalStorage(){JSON.parse(localStorage.getItem("items")).sort((e,t)=>e.secTime>t.secTime?1:e.secTime<t.secTime?-1:0).forEach((e,t)=>{if(t<=9){const s=document.createElement("p"),a=document.createElement("p"),n=document.createElement("p"),r=document.createElement("p"),i=document.createElement("p");s.className="name__user",a.className="date__results",n.className="time__results",r.className="moves__results",i.className="size__field",s.textContent=`${t+1}.${e.name}`,a.textContent=e.data,n.textContent=e.time,r.textContent=e.moves,i.textContent=e.size,results_name.append(s),results_date.append(a),results_time.append(n),results_moves.append(r),results_size.append(i)}})}localStorage.setItem("items",JSON.stringify(itemsArray)),startGame(),pauseGame(),settingsModal(),switchSound(),addDataTolocalStorage(),game_board_wrapper.addEventListener("click",moveDice);